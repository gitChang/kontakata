<% route = Rails.application.routes.url_helpers %>

'use strict';

angular
	.module('kontakata')
	.directive('select', select_picture);

function select_picture() {

	var file_input = document.getElementById('fileInput');
	var	file;
	var	photo = document.getElementsByClassName('select')[0];

	function link_callback(scope, elem) {

		// to prevent erubis for interpolating img.src, we set
        // src = '' and place default value using this line.
        elem.attr('src', scope.img_placehold);

        // fireup input file tag for selecting a photo.
		elem.on('click', function() { file_input.click(); });

        // get the base64 data of the selected photo
        // to be the value of img_data object in the
        // payload and pass it on img.select tag to display.
		file_input.addEventListener('change', function () {
			
			var reader = new FileReader();

			file = this.files[0];

			reader.onload = function () {
				
				scope.model.image_data = reader.result;
				
				scope.model.file_name = file.name;
				
				photo.setAttribute('src', reader.result);
			
			};

			reader.readAsDataURL(file);

		});
	
	}

	return {
		restrict: 'C',
		link: link_callback
	};

}